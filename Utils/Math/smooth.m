function signal_new = smooth(signal, method, len)
% #codegen

if(nargin<2)
    method = 'MA'; % moving average
    len = 5;
end

% Make sure that the signal is 1xN

%% Local params
win = zeros(0, 1);
coder.varsize('win', [1001 1], [1 0]); % #CODER_VARSIZE

%% core code
switch(lower(method))
    case 'ma',
        if(coder.target('matlab'))
            % Check if the length is supported for the coder
            if(~any([501, 201, 101, 15, 51, 13, 9, 5] == len))
                warning('Window length is not supported for the coder. If you wish to use this window length add it here.');
            end
            win = hamming(len);
        else
            switch(len)
                case 501,
                    win = [0.0800000000000000;0.0800363196662446;0.0801452729296820;0.0803268425853290;0.0805809999612320;0.0809077049229951;0.0813069058801176;0.0817785397941407;0.0823225321886019;0.0829387971607962;0.0836272373953402;0.0843877441795405;0.0852201974205595;0.0861244656643807;0.0871004061165656;0.0881478646648032;0.0892666759032464;0.0904566631586310;0.0917176385181746;0.0930494028592500;0.0944517458808297;0.0959244461366940;0.0974672710704005;0.0990799770520071;0.100762309416544;0.102514002504229;0.104334779702418;0.106224353489282;0.108182425479218;0.110208686469958;0.112302816491404;0.114464484856149;0.116693350211700;0.118989060594378;0.121351253484902;0.123779555865631;0.126273584279469;0.128832944890419;0.131457233545770;0.134146035839922;0.136898927179823;0.139715472852018;0.142595228091296;0.145537738150920;0.148542538374442;0.151609154269073;0.154737101580615;0.157925886369926;0.161175005090923;0.164483944670095;0.167852182587524;0.171279186959397;0.174764416621996;0.178307321217155;0.181907341279169;0.185563908323137;0.189276444934734;0.193044364861392;0.196867073104876;0.200743966015240;0.204674431386151;0.208657848551563;0.212693588483729;0.216781013892529;0.220919479326110;0.225108331272803;0.229346908264329;0.233634540980244;0.237970552353640;0.242354257678056;0.246784964715603;0.251261973806278;0.255784577978446;0.260352063060482;0.264963707793541;0.269618783945462;0.274316556425757;0.279056283401692;0.283837216415434;0.288658600502236;0.293519674309662;0.298419670217804;0.303357814460507;0.308333327247550;0.313345422887786;0.318393309913211;0.323476191203947;0.328593264114116;0.333743720598585;0.338926747340571;0.344141525880067;0.349387232743089;0.354663039571715;0.359968113254887;0.365301616059972;0.370662705765048;0.376050535791905;0.381464255339722;0.386903009519426;0.392365939488684;0.397852182587524;0.403360872474564;0.408891139263811;0.414442109662030;0.420012907106647;0.425602651904167;0.431210461369087;0.436835449963285;0.442476729435855;0.448133408963373;0.453804595290567;0.459489392871373;0.465186904010354;0.470896229004452;0.476616466285067;0.482346712560420;0.488086062958199;0.493833611168441;0.499588449586658;0.505349669457151;0.511116361016516;0.516887613637306;0.522662515971830;0.528440156096065;0.534219621653658;0.540000000000000;0.545780378346342;0.551559843903935;0.557337484028170;0.563112386362694;0.568883638983484;0.574650330542849;0.580411550413342;0.586166388831559;0.591913937041802;0.597653287439580;0.603383533714934;0.609103770995548;0.614813095989647;0.620510607128627;0.626195404709434;0.631866591036627;0.637523270564145;0.643164550036715;0.648789538630913;0.654397348095833;0.659987092893352;0.665557890337970;0.671108860736189;0.676639127525436;0.682147817412476;0.687634060511316;0.693096990480574;0.698535744660278;0.703949464208095;0.709337294234952;0.714698383940029;0.720031886745113;0.725336960428285;0.730612767256911;0.735858474119933;0.741073252659429;0.746256279401415;0.751406735885885;0.756523808796053;0.761606690086789;0.766654577112214;0.771666672752450;0.776642185539493;0.781580329782196;0.786480325690339;0.791341399497764;0.796162783584566;0.800943716598308;0.805683443574243;0.810381216054538;0.815036292206459;0.819647936939518;0.824215422021554;0.828738026193722;0.833215035284397;0.837645742321944;0.842029447646360;0.846365459019756;0.850653091735671;0.854891668727197;0.859080520673890;0.863218986107471;0.867306411516271;0.871342151448437;0.875325568613849;0.879256033984760;0.883132926895124;0.886955635138608;0.890723555065266;0.894436091676863;0.898092658720831;0.901692678782845;0.905235583378004;0.908720813040603;0.912147817412476;0.915516055329905;0.918824994909077;0.922074113630074;0.925262898419385;0.928390845730927;0.931457461625558;0.934462261849080;0.937404771908704;0.940284527147982;0.943101072820177;0.945853964160079;0.948542766454231;0.951167055109581;0.953726415720531;0.956220444134369;0.958648746515098;0.961010939405622;0.963306649788301;0.965535515143851;0.967697183508596;0.969791313530042;0.971817574520782;0.973775646510718;0.975665220297582;0.977485997495771;0.979237690583456;0.980920022947993;0.982532728929600;0.984075553863306;0.985548254119170;0.986950597140750;0.988282361481826;0.989543336841369;0.990733324096754;0.991852135335197;0.992899593883435;0.993875534335619;0.994779802579441;0.995612255820460;0.996372762604660;0.997061202839204;0.997677467811398;0.998221460205859;0.998693094119882;0.999092295077005;0.999419000038768;0.999673157414671;0.999854727070318;0.999963680333756;1;0.999963680333756;0.999854727070318;0.999673157414671;0.999419000038768;0.999092295077005;0.998693094119882;0.998221460205859;0.997677467811398;0.997061202839204;0.996372762604660;0.995612255820460;0.994779802579441;0.993875534335619;0.992899593883435;0.991852135335197;0.990733324096754;0.989543336841369;0.988282361481826;0.986950597140750;0.985548254119170;0.984075553863306;0.982532728929600;0.980920022947993;0.979237690583456;0.977485997495771;0.975665220297582;0.973775646510718;0.971817574520782;0.969791313530042;0.967697183508596;0.965535515143851;0.963306649788301;0.961010939405622;0.958648746515098;0.956220444134369;0.953726415720531;0.951167055109581;0.948542766454231;0.945853964160079;0.943101072820177;0.940284527147982;0.937404771908704;0.934462261849080;0.931457461625558;0.928390845730927;0.925262898419385;0.922074113630074;0.918824994909077;0.915516055329905;0.912147817412476;0.908720813040603;0.905235583378004;0.901692678782845;0.898092658720831;0.894436091676863;0.890723555065266;0.886955635138608;0.883132926895124;0.879256033984760;0.875325568613849;0.871342151448437;0.867306411516271;0.863218986107471;0.859080520673890;0.854891668727197;0.850653091735671;0.846365459019756;0.842029447646360;0.837645742321944;0.833215035284397;0.828738026193722;0.824215422021554;0.819647936939518;0.815036292206459;0.810381216054538;0.805683443574243;0.800943716598308;0.796162783584566;0.791341399497764;0.786480325690339;0.781580329782196;0.776642185539493;0.771666672752450;0.766654577112214;0.761606690086789;0.756523808796053;0.751406735885885;0.746256279401415;0.741073252659429;0.735858474119933;0.730612767256911;0.725336960428285;0.720031886745113;0.714698383940029;0.709337294234952;0.703949464208095;0.698535744660278;0.693096990480574;0.687634060511316;0.682147817412476;0.676639127525436;0.671108860736189;0.665557890337970;0.659987092893352;0.654397348095833;0.648789538630913;0.643164550036715;0.637523270564145;0.631866591036627;0.626195404709434;0.620510607128627;0.614813095989647;0.609103770995548;0.603383533714934;0.597653287439580;0.591913937041802;0.586166388831559;0.580411550413342;0.574650330542849;0.568883638983484;0.563112386362694;0.557337484028170;0.551559843903935;0.545780378346342;0.540000000000000;0.534219621653658;0.528440156096065;0.522662515971830;0.516887613637306;0.511116361016516;0.505349669457151;0.499588449586658;0.493833611168441;0.488086062958199;0.482346712560420;0.476616466285067;0.470896229004452;0.465186904010354;0.459489392871373;0.453804595290567;0.448133408963373;0.442476729435855;0.436835449963285;0.431210461369087;0.425602651904167;0.420012907106647;0.414442109662030;0.408891139263811;0.403360872474564;0.397852182587524;0.392365939488684;0.386903009519426;0.381464255339722;0.376050535791905;0.370662705765048;0.365301616059972;0.359968113254887;0.354663039571715;0.349387232743089;0.344141525880067;0.338926747340571;0.333743720598585;0.328593264114116;0.323476191203947;0.318393309913211;0.313345422887786;0.308333327247550;0.303357814460507;0.298419670217804;0.293519674309662;0.288658600502236;0.283837216415434;0.279056283401692;0.274316556425757;0.269618783945462;0.264963707793541;0.260352063060482;0.255784577978446;0.251261973806278;0.246784964715603;0.242354257678056;0.237970552353640;0.233634540980244;0.229346908264329;0.225108331272803;0.220919479326110;0.216781013892529;0.212693588483729;0.208657848551563;0.204674431386151;0.200743966015240;0.196867073104876;0.193044364861392;0.189276444934734;0.185563908323137;0.181907341279169;0.178307321217155;0.174764416621996;0.171279186959397;0.167852182587524;0.164483944670095;0.161175005090923;0.157925886369926;0.154737101580615;0.151609154269073;0.148542538374442;0.145537738150920;0.142595228091296;0.139715472852018;0.136898927179823;0.134146035839922;0.131457233545770;0.128832944890419;0.126273584279469;0.123779555865631;0.121351253484902;0.118989060594378;0.116693350211700;0.114464484856149;0.112302816491404;0.110208686469958;0.108182425479218;0.106224353489282;0.104334779702418;0.102514002504229;0.100762309416544;0.0990799770520071;0.0974672710704005;0.0959244461366940;0.0944517458808297;0.0930494028592500;0.0917176385181746;0.0904566631586310;0.0892666759032464;0.0881478646648032;0.0871004061165656;0.0861244656643807;0.0852201974205595;0.0843877441795405;0.0836272373953402;0.0829387971607962;0.0823225321886019;0.0817785397941407;0.0813069058801176;0.0809077049229951;0.0805809999612320;0.0803268425853290;0.0801452729296820;0.0800363196662446;0.0800000000000000];
                case 201,
                    win = [0.0800000000000000;0.0802269822317635;0.0809077049229951;0.0820414962825832;0.0836272373953402;0.0856633633262366;0.0881478646648032;0.0910782895081762;0.0944517458808297;0.0982649045886062;0.102514002504229;0.107194846281056;0.112302816491404;0.117832872185369;0.123779555865631;0.130136998873351;0.136898927179823;0.144058667578186;0.151609154269073;0.159542935833702;0.167852182587524;0.176528694307182;0.185563908323137;0.194948907969989;0.204674431386151;0.214730880654188;0.225108331272803;0.235796541951120;0.246784964715603;0.258062755319631;0.269618783945462;0.281441646188020;0.293519674309662;0.305840948754829;0.318393309913211;0.331164370119809;0.344141525880067;0.357311970308001;0.370662705765048;0.384180556687166;0.397852182587524;0.411664091221954;0.425602651904167;0.439654108957590;0.453804595290567;0.468040146081494;0.482346712560420;0.496710175873483;0.511116361016516;0.525551050824061;0.540000000000000;0.554448949175939;0.568883638983484;0.583289824126517;0.597653287439580;0.611959853918506;0.626195404709434;0.640345891042410;0.654397348095833;0.668335908778046;0.682147817412476;0.695819443312834;0.709337294234952;0.722688029691999;0.735858474119933;0.748835629880192;0.761606690086789;0.774159051245171;0.786480325690339;0.798558353811980;0.810381216054538;0.821937244680369;0.833215035284397;0.844203458048880;0.854891668727197;0.865269119345812;0.875325568613849;0.885051092030011;0.894436091676863;0.903471305692818;0.912147817412476;0.920457064166299;0.928390845730927;0.935941332421814;0.943101072820177;0.949863001126649;0.956220444134369;0.962167127814631;0.967697183508596;0.972805153718944;0.977485997495771;0.981735095411394;0.985548254119170;0.988921710491824;0.991852135335197;0.994336636673763;0.996372762604660;0.997958503717417;0.999092295077005;0.999773017768237;1;0.999773017768237;0.999092295077005;0.997958503717417;0.996372762604660;0.994336636673763;0.991852135335197;0.988921710491824;0.985548254119170;0.981735095411394;0.977485997495771;0.972805153718944;0.967697183508596;0.962167127814631;0.956220444134369;0.949863001126649;0.943101072820177;0.935941332421814;0.928390845730927;0.920457064166299;0.912147817412476;0.903471305692818;0.894436091676863;0.885051092030011;0.875325568613849;0.865269119345812;0.854891668727197;0.844203458048880;0.833215035284397;0.821937244680369;0.810381216054538;0.798558353811980;0.786480325690339;0.774159051245171;0.761606690086789;0.748835629880192;0.735858474119933;0.722688029691999;0.709337294234952;0.695819443312834;0.682147817412476;0.668335908778046;0.654397348095833;0.640345891042410;0.626195404709434;0.611959853918506;0.597653287439580;0.583289824126517;0.568883638983484;0.554448949175939;0.540000000000000;0.525551050824061;0.511116361016516;0.496710175873483;0.482346712560420;0.468040146081494;0.453804595290567;0.439654108957590;0.425602651904167;0.411664091221954;0.397852182587524;0.384180556687166;0.370662705765048;0.357311970308001;0.344141525880067;0.331164370119809;0.318393309913211;0.305840948754829;0.293519674309662;0.281441646188020;0.269618783945462;0.258062755319631;0.246784964715603;0.235796541951120;0.225108331272803;0.214730880654188;0.204674431386151;0.194948907969989;0.185563908323137;0.176528694307182;0.167852182587524;0.159542935833702;0.151609154269073;0.144058667578186;0.136898927179823;0.130136998873351;0.123779555865631;0.117832872185369;0.112302816491404;0.107194846281056;0.102514002504229;0.0982649045886062;0.0944517458808297;0.0910782895081762;0.0881478646648032;0.0856633633262366;0.0836272373953402;0.0820414962825832;0.0809077049229951;0.0802269822317635;0.0800000000000000];
                case 101,
                    win = [0.0800000000000000;0.0809077049229951;0.0836272373953402;0.0881478646648032;0.0944517458808297;0.102514002504229;0.112302816491404;0.123779555865631;0.136898927179823;0.151609154269073;0.167852182587524;0.185563908323137;0.204674431386151;0.225108331272803;0.246784964715603;0.269618783945462;0.293519674309662;0.318393309913211;0.344141525880067;0.370662705765048;0.397852182587524;0.425602651904167;0.453804595290567;0.482346712560420;0.511116361016516;0.540000000000000;0.568883638983484;0.597653287439580;0.626195404709434;0.654397348095833;0.682147817412476;0.709337294234952;0.735858474119933;0.761606690086789;0.786480325690339;0.810381216054538;0.833215035284397;0.854891668727197;0.875325568613849;0.894436091676863;0.912147817412476;0.928390845730927;0.943101072820177;0.956220444134369;0.967697183508596;0.977485997495771;0.985548254119170;0.991852135335197;0.996372762604660;0.999092295077005;1;0.999092295077005;0.996372762604660;0.991852135335197;0.985548254119170;0.977485997495771;0.967697183508596;0.956220444134369;0.943101072820177;0.928390845730927;0.912147817412476;0.894436091676863;0.875325568613849;0.854891668727197;0.833215035284397;0.810381216054538;0.786480325690339;0.761606690086789;0.735858474119933;0.709337294234952;0.682147817412476;0.654397348095833;0.626195404709434;0.597653287439580;0.568883638983484;0.540000000000000;0.511116361016516;0.482346712560420;0.453804595290567;0.425602651904167;0.397852182587524;0.370662705765048;0.344141525880067;0.318393309913211;0.293519674309662;0.269618783945462;0.246784964715603;0.225108331272803;0.204674431386151;0.185563908323137;0.167852182587524;0.151609154269073;0.136898927179823;0.123779555865631;0.112302816491404;0.102514002504229;0.0944517458808297;0.0881478646648032;0.0836272373953402;0.0809077049229951;0.0800000000000000];
                case 51,
                    win = [0.0800000000000000;0.0836272373953402;0.0944517458808297;0.112302816491404;0.136898927179823;0.167852182587524;0.204674431386151;0.246784964715603;0.293519674309662;0.344141525880067;0.397852182587524;0.453804595290567;0.511116361016516;0.568883638983484;0.626195404709434;0.682147817412476;0.735858474119933;0.786480325690339;0.833215035284397;0.875325568613849;0.912147817412476;0.943101072820177;0.967697183508596;0.985548254119170;0.996372762604660;1;0.996372762604660;0.985548254119170;0.967697183508596;0.943101072820177;0.912147817412476;0.875325568613849;0.833215035284397;0.786480325690339;0.735858474119933;0.682147817412476;0.626195404709434;0.568883638983484;0.511116361016516;0.453804595290567;0.397852182587524;0.344141525880067;0.293519674309662;0.246784964715603;0.204674431386151;0.167852182587524;0.136898927179823;0.112302816491404;0.0944517458808297;0.0836272373953402;0.0800000000000000];
                case 15,
                    win = [0.0800000000000000;0.125554320764887;0.253194691144983;0.437640370380095;0.642359629619905;0.826805308855018;0.954445679235113;1;0.954445679235113;0.826805308855018;0.642359629619905;0.437640370380095;0.253194691144983;0.125554320764887;0.0800000000000000];
                case 13,
                    win = [0.0800000000000000;0.141628314259158;0.310000000000000;0.540000000000000;0.770000000000000;0.938371685740842;1;0.938371685740842;0.770000000000000;0.540000000000000;0.310000000000000;0.141628314259158;0.0800000000000000];
                case 9,
                    win = [0.0800000000000000;0.214730880654188;0.540000000000000;0.865269119345812;1;0.865269119345812;0.540000000000000;0.214730880654188;0.0800000000000000];
                case 5,
                    win = [0.0800000000000000;0.540000000000000;1;0.540000000000000;0.0800000000000000];
                otherwise,
                    error('Window length is not supported. If you wish to use this window length add it here.');
            end
        end
        
        win = win/sum(win);
        signal_new = conv(signal, win);
        signal_new = circshift(signal_new, [0, -floor(len/2)]);
        signal_new(end-(len-2):end) = [];
    otherwise
        error('Method is not supported.');
end
